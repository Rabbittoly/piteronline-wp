!function(){function r(t){for(var e=0,a=["=","!=",">","<","<=",">="],n=0;n<t.length;n++){if(-1<a.indexOf(t[n])&&!e)return{operand:t[n],left:t.substring(0,n).trim(),right:t.substring(n<t.length-1?n+1:n).trim()};"("==t[n]&&e++,")"==t[n]&&e--}return{operand:"=",left:t,right:"true"}}function i(t,e){return"true"===(t=p(t,e,!1))||"false"!==t&&(""===t?"":(e=c.evalFx(""+t,!1),isNaN(e)?t:e))}function f(t,e,a,n){switch(t=i(t,n),e=i(e,n),a){case"<":return t<e;case">":return e<t;case">=":return e<=t;case"<=":return t<=e;case"!=":return t!==e;default:return t===e}}var s=".wapf-",c=WAPF.Util,p=c.parseFx,t=WAPF.Util.formulas;["abs","floor","ceil","sqrt","sin","cos","tan"].forEach(function(a){t[a]=function(t,e){return Math[a](p(t[0],e))}}),t.formatNumber=function(t,e){var a=wapf_config.display_options,e=p(t[0],e);return c.formatNumber(e,1<t.length?t[1]:a.decimals,a.thousand,a.decimal,a.trimzero)},t.round=function(t,e){var a=p(t[0],e);if(t[1]){e=p(t[1],e);return Math.round(a*Math.pow(10,e))/Math.pow(10,e)}return Math.round(a)},t.pow=function(t,e){return Math.pow(p(t[0],e),p(t[1],e))},t.checked=function(t,e){t=e.find(".input-"+t[0]),t=c.getFieldValue(t,!0);return Array.isArray(t)?t.length:0},t.files=function(t,e){t=e.find(".input-"+t[0]);if(1!==t.length)return 0;t=c.getFieldValue(t,!0);return t?t.split(",").length:0},t.sumQty=function(t,e){var e=e.find(".field-"+p(t[0],e,!1)+" .wapf-input"),a=0;return e.each(function(){a+=Number(jQuery(this).val())}),a},t.if=function(t,e){var a=r(t[0]);return f(a.left,a.right,a.operand,e)?t[1]:t[2]},t.or=function(t,e){for(var a=0;a<t.length;a++){var n=r(t[a]);if(f(n.left,n.right,n.operand,e))return"true"}return"false"},t.and=function(t,e){for(var a=0;a<t.length;a++){var n=r(t[a]);if(!f(n.left,n.right,n.operand,e))return"false"}return"true"},t.datediff=function(t,e){var a=wapf_config.date_format,n=t[0]?p(t[0],e,!1):"",e=t[1]?p(t[1],e,!1):"";return n&&e?(n=dpParseDate(n,a),e=dpParseDate(e,a),Math.round((e.getTime()-n.getTime())/864e5)):0},t.today=function(){return dpFormatDate(new Date(wapf_config.today),wapf_config.date_format)},t.dow=function(t,e){var a=wapf_config.date_format,e=t[0]?p(t[0],e,!1):"";return e?(e=dpParseDate(e,a)).getDay():0};function u(t,e,a){var n="string"==typeof t?t.split(/-/g):t,r=parseInt(n[0])-1,i=parseInt(n[1]),t=e||(2===n.length?(new Date).getFullYear():parseInt(n[2]));return a||1!=r||29!==i||e%4==0&&(e%100!=0||e%400==0)?((n=new Date(new Date(t,parseInt(n[0])-1,parseInt(n[1])).getTime())).setHours(0,0,0,0),n):null}function d(t,e){if(!e)return t;var a=new Date(t.getTime()),n=0,r=0,i=0,f=e.split(" ");if(f.length)for(var d=0;d<f.length;d++){var u=f[d].toLowerCase();-1<u.indexOf("y")&&(n+=parseInt(u.replace("y",""))),-1<u.indexOf("m")&&(r+=parseInt(u.replace("m",""))),-1<u.indexOf("d")&&(i+=parseInt(u.replace("d","")))}return i&&a.setDate(t.getDate()+i),r&&a.setMonth(t.getMonth()+r),n&&a.setFullYear(t.getFullYear()+n),a}function l(t,e,a){var n,r=e.field.data(t),i=null;return r&&(g[t][a]?i=g[t][a]:new RegExp("[0-9]{2}-[0-9]{2}([0-9]{4})?").test(r)?(i=u(r),g[t][a]=i):0===r.indexOf("[field")?(n=/field.(.+?)\]/.exec(r))&&(!(n=e.field.closest(".wapf").find(".input-"+n[1]))||(n=c.getFieldValue(n,!0))&&(i=d(dpParseDate(n,wapf_config.date_format),r.replace(/\[(.+)\]/,"").trim()))):(i=d(e.today,r),g[t][a]=i)),i}var o={},g={min:{},max:{}};WAPF.Filter.add("date/selectable",function(t,e){if(!t)return!t;var a=e.field.data("field-id");if(e.field.data("disable-after")&&e.isToday){var n=e.field.data("disable-after").split(":"),r=new Date((new Date).getTime()+(1e3*e.offset+6e4*(new Date).getTimezoneOffset()));if(r.getHours()>=parseInt(n[0])&&r.getMinutes()>=parseInt(n[1]))return!1}if(void 0!==e.field.data("disabled-days")&&-1<(f=(""+e.field.data("disabled-days")).split(",").map(function(t){return parseInt(t)})).indexOf(e.date.getDay()))return!1;n=l("min",e,a);if(n&&e.date<n)return!1;if((n=l("max",e,a))&&e.date>n)return!1;if(e.field.data("disabled-dates")){o[a]||(o[a]=[],e.field.data("disabled-dates").split(",").map(function(t){return t.trim()}).forEach(function(t){var e;-1<t.indexOf(" ")?(e=t.split(" "),o[a].push({start:e[0].split(/-/g),end:e[1].split(/-/g)})):o[a].push({start:t.split(/-/g)})}));for(var i=0;i<o[a].length;i++){var f,d=o[a][i];if(f=u(d.start,2===d.start.length?e.date.getFullYear():null,d.end))if(d.end){d=u(d.end,2===d.end.length?e.date.getFullYear():null,!0);if(d&&e.date>=f&&e.date<=d)return!1}else if(e.date.getMonth()===f.getMonth()&&e.date.getFullYear()===f.getFullYear()&&e.date.getDate()===f.getDate())return!1}}return t}),jQuery(document).on("wapf/init",function(t,o){var e,a=o.find(s+"field-calc");a.length&&(jQuery(document).on("wapf/cloned wapf/uncloned",function(){a=o.find(s+"field-calc")}),jQuery(document).on("wapf/cloned",function(t,e,n,a,r){a.find(s+"calc-text").each(function(t,e){var a=jQuery(e);"default"===a.data("type")&&(e=c.cloneFx(a.data("formula"),r,n),a.attr("data-formula",e).data("formula",e))})}),e=function(){a.each(function(t,e){var a,n,r,i,f,d,u,l=jQuery(e);l.hasClass("wapf-hide")||(a=l.find(s+"calc-text"),n=l.find("input"),u=0,"cost"===a.data("type")?u=c.formatMoney(WAPF.Filter.apply("wapf/fx/hint",n.data("price")),wapf_config.display_options):(r=wapf_config.display_options,i=a.data("format"),f=c.getQty(o),d=c.currentProductPrice(o),e=c.replaceFx(a.data("formula"),f,d,0,o,o.data("optionsTotal")||0),e=c.evalVars(WAPF.Pricing.variables,e,0,f,d,l,o,o.data("optionsTotal")||0),u=p(e,o,!1),"number"===i&&(u=c.evalFx(u),u=c.formatNumber(u,r.decimals,r.thousand,r.decimal,r.trimzero))),u=a.data("txt").replace(/\{result}/g,u),a.html(u),n.val(u))})},o.on("keyup change",'.wapf-input, input[name="variation_id"]',e),o.data("$qty").on("change",e),e())})}();